# compare-to-osm

This program compares the geometries of highways in OSM with those in one or more shapefiles.

It generates GeoJSON files and Shapefiles with highways missing in OSM and in the open data and shows the results on a Leaflet map, as Topojson files or PNG tiles.

[Here](https://dl.dropboxusercontent.com/u/41550819/OSM/compare-to-osm/index.html) is an ouput example with open data from Italy.

## Dependencies
Programs:

* wget
* osmconvert
* ogr2ogr
* topojson
* mapnik
* jinja2

In Ubuntu, install everything with:

        sudo apt-get install osmctools gdal-bin nodejs python-mapnik python-jinja2
        sudo npm install -g topojson

You will also need Spatialite or PostGIS, depending on the comparator you use (see section below):

        sudo apt-get install spatialite-bin

or

        sudo apt-get install postgis postgresql-contrib osmosis

Data:

* a WGS84 shapefile with open data regarding highways from the the zone of your interest, e.g. a local council
* a Shapefile with the boundaries of the zone (if using `highwaysgeometryspatialite` comparator).

## Usage
### Configuration
Create a new project directory and add a `project.json` file with the configuration.<br>For more informations, see `projects/README.md` and `projects/projectdemo`.

### Execution
Show the list of options:

        pyhton ./compare-to-osm.py -h

Analyse the data and create the output files:

        pyhton ./compare-to-osm.py projects/myproject/project.json --analyse

Read analysis' output files, create map data (GeoJSON or PNG tiles) and the web page:

        pyhton ./compare-to-osm.py projects/myproject/project.json --create_web_page

Open `projects/myproject/html/index.html` in a web browser to see the results.

### Demo
* Download OSM data, compare it with the open data and create the web page by running:

       `python ./compare-to-osm.py projects/projectdemo/project.json --donwload_osm --analyse --create_web_page`

* See the result by opening `projects/projectdemo/html/index.html` in a web browser.

## Notes

### Comparators
The comparison is performed by one of the modules in `comparators` directory:

* `comparators/highwaysgeometryspatialite.py` needs spatialite-bin package and supports Linestring or Multilinestring shapefiles.
* `comparators/highwaysgeometrypostgis.py` needs PostGIS and osmosis and supports Multilinestring shapefiles.

You may write new modules to compare different OSM object (e.g. rivers). Add a module in `comparators/` and write its name in the project file (e.g. `"comparator": "riversgeometryspatialite"`).

### OpenStreetMap data
For small areas you can download the OSM data from Overpass by using `--download_osm` option. The query must be written in `project.json` (see `projects/projectdemo/project.json`).

For big areas you may prefer to create the OSM file manually. E.g.:

       osmconvert Italy.pbf -B=Verona.poly -o=Verona.o5m

       osmfilter --keep=  --keep=highway Verona.o5m -o=projects/myproject/data/OSM/Verona_highways.osm`

where `Verona_highways` is the name of a task in `project.json`.

### Creating a custom web page
The web page is based on the Jinja2 template `html/templates/index.html`. A custom web page can be generated by adding a custom template `index.html` in `project_directory/templates` directory.

## Development
License: GPL v3

Author: Simone F.

Coding conventions: flake8
